<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profil Pengguna - LockIn</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to bottom right, #0d0e10, #1e2d54);
      color: white;
    }
    .sidebar {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 30px rgba(30, 64, 175, 0.3);
    }
    .nav-item {
      padding: 0.75rem;
      border-radius: 0.5rem;
      color: #94a3b8;
      transition: all 0.2s ease;
    }
    .nav-item:hover,
    .nav-item.active {
      background-color: #1e293b;
      color: #fff;
    }
    .glass-box {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    input[type="file"] {
      display: none;
    }
  </style>
</head>
<body class="min-h-screen flex">
  <!-- Sidebar -->
  <aside class="sidebar w-64 p-6 hidden md:flex flex-col justify-between rounded-2xl ml-4 mt-6 mb-9">
    <div>
      <div class="flex items-center space-x-2 mb-6">
        <div class="w-4 h-4 rounded bg-blue-500"></div>
        <h1 class="text-white text-xl font-bold">Lock<span class="text-blue-400">In</span></h1>
      </div>
      <p class="text-white text-sm mb-6 uppercase font-bold tracking-widest">HI, GANTENG!</p>
      <nav class="space-y-2">
        <a href="dashboard.html" class="nav-item block flex items-center space-x-2">
          <i class="fas fa-chart-pie"></i><span>dashboard</span>
        </a>
        <a href="password-bank.html" class="nav-item block flex items-center space-x-2">
          <i class="fas fa-key"></i><span>password bank</span>
        </a>
        <a href="password-generator.html" class="nav-item block flex items-center space-x-2">
          <i class="fas fa-random"></i><span>password generator</span>
        </a>
        <a href="support.html" class="nav-item block flex items-center space-x-2">
          <i class="fas fa-question-circle"></i><span>support</span>
        </a>
        <a href="#" class="nav-item active block flex items-center space-x-2">
          <i class="fas fa-user"></i><span>profil</span>
        </a>
      </nav>
    </div>
    <div class="mt-6">
      <button class="w-full text-sm bg-gray-800 hover:bg-gray-700 text-white py-2 px-3 rounded flex items-center justify-center space-x-2">
        <i class="fas fa-sign-out-alt"></i><span>Logout</span>
      </button>
      <div class="flex items-center space-x-2 mt-4">
        <div class="w-8 h-8 rounded-full bg-slate-600"></div>
        <div class="text-xs text-white">ikrar@gmail.com</div>
      </div>
    </div>
  </aside>

  <!-- Main content -->
  <main class="flex-1 p-6 space-y-8">
    <!-- Header Section -->
    <div class="glass-box p-8 rounded-2xl shadow-lg relative overflow-hidden">
      <div class="absolute -top-10 -left-10 w-40 h-40 bg-blue-500 rounded-full blur-3xl opacity-30"></div>
      <div class="absolute -bottom-10 -right-10 w-40 h-40 bg-purple-500 rounded-full blur-3xl opacity-30"></div>

      <div class="flex flex-col md:flex-row items-center md:items-start md:space-x-8 mb-8">
        <div class="relative w-28 h-28">
          <img id="profile-preview" src="https://i.pravatar.cc/150?img=3" alt="Avatar" class="w-full h-full rounded-full border-4 border-blue-600 shadow-lg object-cover">
          <label for="profile-upload" class="absolute bottom-0 right-0 bg-blue-600 p-2 rounded-full hover:bg-blue-500 cursor-pointer">
            <i class="fas fa-camera text-white text-sm"></i>
          </label>
          <input id="profile-upload" type="file" accept="image/*" onchange="previewImage(event)">
        </div>
        <div class="mt-4 md:mt-0 text-center md:text-left">
          <h2 class="text-3xl font-bold">Ikrar Ramadhan</h2>
          <p class="text-sm text-slate-300">ikrar@gmail.com</p>
          <button class="mt-3 px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md text-sm">Edit Profil</button>
        </div>
      </div>

      <!-- Informasi akun -->
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <label class="block mb-1 text-sm font-medium">Nama Lengkap</label>
          <input type="text" class="w-full bg-[#0f172a] border border-slate-600 text-white px-4 py-2 rounded-lg" value="Ikrar Ramadhan">
        </div>
        <div>
          <label class="block mb-1 text-sm font-medium">Email</label>
          <input type="email" class="w-full bg-[#0f172a] border border-slate-600 text-white px-4 py-2 rounded-lg" value="ikrar@gmail.com">
        </div>
        <div>
          <label class="block mb-1 text-sm font-medium">Username</label>
          <input type="text" class="w-full bg-[#0f172a] border border-slate-600 text-white px-4 py-2 rounded-lg" value="ikraruser">
        </div>
        <div>
          <label class="block mb-1 text-sm font-medium">Kata Sandi Baru</label>
          <input type="password" placeholder="********" class="w-full bg-[#0f172a] border border-slate-600 text-white px-4 py-2 rounded-lg">
        </div>
      </div>

      <div class="mt-6 flex justify-end">
        <button class="bg-blue-600 hover:bg-blue-500 px-6 py-2 rounded-lg text-white font-semibold">
          Simpan Perubahan
        </button>
      </div>
    </div>

    <!-- Tambahan Section: Aktivitas dan Statistik -->
    <div class="grid md:grid-cols-2 gap-6">
      <div class="glass-box p-6 rounded-2xl">
        <h3 class="text-xl font-bold mb-4">Aktivitas Terakhir</h3>
        <ul class="space-y-2 text-sm text-slate-300">
          <li><i class="fas fa-check-circle text-green-400 mr-2"></i> Login terakhir: 21 Juni 2025 - 13:42</li>
          <li><i class="fas fa-key text-yellow-400 mr-2"></i> Mengubah password di LockIn</li>
          <li><i class="fas fa-cloud-upload-alt text-blue-400 mr-2"></i> Ekspor data dilakukan</li>
        </ul>
      </div>
      <div class="glass-box p-6 rounded-2xl">
        <h3 class="text-xl font-bold mb-4">Statistik Akun</h3>
        <div class="grid grid-cols-2 gap-4 text-center">
          <div>
            <p class="text-3xl font-bold">12</p>
            <p class="text-sm text-slate-300">Password Tersimpan</p>
          </div>
          <div>
            <p class="text-3xl font-bold">5</p>
            <p class="text-sm text-slate-300">Password Kuat</p>
          </div>
          <div>
            <p class="text-3xl font-bold">3</p>
            <p class="text-sm text-slate-300">Aktivitas Minggu Ini</p>
          </div>
          <div>
            <p class="text-3xl font-bold">89%</p>
            <p class="text-sm text-slate-300">Tingkat Keamanan</p>
          </div>
        </div>
      </div>
     
<!-- Tambahkan sebelum tag <script> custom kamu -->
<script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore-compat.js"></script>


<script>
  // Firebase config dan inisialisasi
  const firebaseConfig = {
    apiKey: "AIzaSyCmWQLZPbStBGyfkJD5xB50n1OmM4WCBgs",
    authDomain: "uas-kemdig.firebaseapp.com",
    databaseURL: "https://uas-kemdig-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "uas-kemdig",
    storageBucket: "uas-kemdig.appspot.com", // *** perbaikan di sini ***
    messagingSenderId: "539547663847",
    appId: "1:539547663847:web:71c334dc0afaade18cd142",
    measurementId: "G-ECG0KWP85C"
  };

  firebase.initializeApp(firebaseConfig);
  const storage = firebase.storage();
  const firestore = firebase.firestore();

  // User ID statis (ganti sesuai user login kalau pakai Firebase Auth)
  const userId = "user123";

  // Fungsi load URL foto profil dari Firestore saat halaman dimuat
  window.addEventListener('DOMContentLoaded', async () => {
    try {
      const docRef = firestore.collection('users').doc(userId);
      const docSnap = await docRef.get();
      console.log('Firestore document exists?', docSnap.exists);
      if (docSnap.exists) {
        const data = docSnap.data();
        console.log('Data Firestore:', data);
        if (data && data.profilePhotoUrl) {
          document.getElementById('profile-preview').src = data.profilePhotoUrl;
          console.log("Foto profil di-load dari Firestore:", data.profilePhotoUrl);
        }
      } else {
        console.log("Dokumen Firestore user tidak ditemukan");
      }
    } catch (error) {
      console.error("Error mengambil data profil dari Firestore:", error);
    }
  });

  // Fungsi upload dan preview foto + simpan URL ke Firestore
  async function previewImage(event) {
    const file = event.target.files[0];
    const preview = document.getElementById('profile-preview');
    if (!file) return;

    // Preview local dulu
    const reader = new FileReader();
    reader.onload = function (e) {
      preview.src = e.target.result;
    };
    reader.readAsDataURL(file);

    try {
      // Nama file unik supaya tidak overwrite
      const uniqueFileName = Date.now() + "-" + file.name;
      const storageRef = firebase.storage().ref();
      const fileRef = storageRef.child("profile-pictures/" + userId + "/" + uniqueFileName);

      // Upload file
      const uploadTaskSnapshot = await fileRef.put(file);
      console.log('Upload selesai:', uploadTaskSnapshot);

      // Ambil URL download
      const downloadURL = await fileRef.getDownloadURL();
      preview.src = downloadURL;
      console.log("Foto berhasil diupload dan URL didapat:", downloadURL);

      // Simpan URL ke Firestore (merge agar tidak overwrite data lain)
      await firestore.collection('users').doc(userId).set({
        profilePhotoUrl: downloadURL
      }, { merge: true });
      console.log("URL foto berhasil disimpan ke Firestore");
    } catch (err) {
      console.error("Gagal upload atau simpan URL:", err);
      alert("Gagal upload foto, coba lagi.");
    }
  }
</script>




